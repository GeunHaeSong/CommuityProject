<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="mappers.board-mapper">
	<!-- 게시판 글 쓸때 삭제되지 않은 카테고리 가져오기 -->
	<select id="getCategory" resultType="RegistCategory">
		select category_code, category_name from tbl_category
		where category_state = 'Y'
		order by category_code asc
	</select>
	
	<!-- 게시판 글 가져오기(삭제되지않은것) -->
	<select id="getBoardList" resultType="BoardVo">
		select * from (select rownum rnum, a.* from (select * from tbl_board
		where category_code = #{category_code} and board_state = 'Y' order by board_num desc) a)
		where rnum between #{startRow} and #{endRow}
	</select>
	
	<!-- 게시판 전체 게시글 수 가져오기(삭제되지않은것) -->
	<select id="getBoardTotalCount" resultType="integer">
		select count(*) from tbl_board
		where board_state = 'Y'
	</select>
	
	<!-- 게시판 글쓰기 -->
	<insert id="insertBoard">
		insert into tbl_board(BOARD_NUM, CATEGORY_CODE, MEMBER_ID, BOARD_TITLE, BOARD_CONTENT, BOARD_MAIN_IMAGE)
		values(seq_board.nextval, #{category_code}, #{member_id}, #{board_title}, #{board_content}, #{board_main_image})
	</insert>
	
	<!-- 게시판 제일 최근 숫자 들고오기(이미지 업로드에서 board_num 구하기) -->
	<select id="getLastBoardNum" resultType="integer">
		select board_num from (select rownum rnum, a.* from (select board_num from tbl_board
		order by board_num desc) a)
        where rnum = 1
	</select>
	
	<!-- 이미지 업로드 -->
	<insert id="insertImage">
		insert into tbl_image(IMAGE_CODE, BOARD_NUM, IMAGE_NAME)
		values('BI' || seq_image.nextval, #{board_num}, #{image_name})
	</insert>
	
</mapper>